(self.webpackChunkrport_site=self.webpackChunkrport_site||[]).push([[97],{3029:(n,e,t)=>{"use strict";t.r(e),t.d(e,{data:()=>s});const s={key:"v-2d327c5c",path:"/docs/no01-on-demand-tunnels.html",title:"On-demand tunnels using the API",lang:"en-DE",frontmatter:{},excerpt:"",headers:[{level:2,title:"Activate the API",slug:"activate-the-api",children:[]},{level:2,title:"Connect a client without a tunnel",slug:"connect-a-client-without-a-tunnel",children:[]},{level:2,title:"Manage clients and tunnels through the API",slug:"manage-clients-and-tunnels-through-the-api",children:[]}],filePathRelative:"docs/no01-on-demand-tunnels.md"}},5226:(n,e,t)=>{"use strict";t.r(e),t.d(e,{default:()=>L});var s=t(6252);const a=(0,s.uE)('<h1 id="on-demand-tunnels-using-the-api"><a class="header-anchor" href="#on-demand-tunnels-using-the-api">#</a> On-demand tunnels using the API</h1><p>Initializing the creation of a tunnel from the client is nice but not a perfect solution for secure and reliable remote access to a large number of machines. Most of the time the tunnel wouldn&#39;t be used. Network resources would be wasted and a port is exposed to the internet for an unnecessarily long time. Rport provides the option to establish tunnels from the server only when you need them.</p><h2 id="activate-the-api"><a class="header-anchor" href="#activate-the-api">#</a> Activate the API</h2><p>Using the provided <code>rportd.example.conf</code> the internal management API is enabled by default listening on http://localhost:3000.</p><p>Set up <code>[api]</code> config params. For example:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># specify non-empty api.address to enable API support\n[api]\n  # Defines the IP address and port the API server listens on\n  address = &quot;127.0.0.1:3000&quot;\n  # Defines &lt;user:password&gt; authentication pair for accessing API\n  auth = &quot;admin:foobaz&quot;\n  jwt_secret = &quot;quei1too2Jae3xootu&quot;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div>',6),o=(0,s.Uk)('This opens the API and enables HTTP basic authentication with a single user "admin:foobaz" who has access to the API. Restart the rportd after any changes to the configuration. Read more about API '),u=(0,s.Uk)("authentication options"),l=(0,s.Uk)("."),r=(0,s.Wm)("div",{class:"custom-container danger"},[(0,s.Wm)("p",{class:"custom-container-title"},"WARNING"),(0,s.Wm)("p",null,[(0,s.Uk)("Do not run the API on public servers with the default credentials. Change the "),(0,s.Wm)("code",null,"auth="),(0,s.Uk)(" settings and generate your own "),(0,s.Wm)("code",null,"jwt_secret"),(0,s.Uk)(", e.g. by using the command "),(0,s.Wm)("code",null,"pwgen 24 1"),(0,s.Uk)(" or "),(0,s.Wm)("code",null,"openssl rand -hex 12"),(0,s.Uk)(".")])],-1),i={class:"custom-container tip"},p=(0,s.Wm)("p",{class:"custom-container-title"},"TIP",-1),c=(0,s.Uk)("If you expose your API to the public internet, it's highly recommended to enable HTTPS. Read the "),b=(0,s.Uk)("quick HTTPS howto"),m=(0,s.Uk)("."),d=(0,s.Wm)("p",null,[(0,s.Uk)("Test if you set up the API properly by querying its status with "),(0,s.Wm)("code",null,"curl -s -u admin:foobaz http://localhost:3000/api/v1/status"),(0,s.Uk)(".")],-1),h={class:"custom-container tip"},q=(0,s.Wm)("p",{class:"custom-container-title"},"TIP",-1),g=(0,s.Uk)("The API always returns a minified json formatted response. The large output is hard to read. In all further examples, we use the command-line tool "),f={href:"https://stedolan.github.io/jq/",target:"_blank",rel:"noopener noreferrer"},v=(0,s.Uk)("jq"),k=(0,s.Uk)(" to reformat the json with line breaks and indentation for better readability. "),x=(0,s.Wm)("code",null,"jq",-1),w=(0,s.Uk)("is included in almost any distribution, for Windows you can download it "),y={href:"https://stedolan.github.io/jq/download/",target:"_blank",rel:"noopener noreferrer"},I=(0,s.Uk)("here"),P=(0,s.Uk)("."),U=(0,s.uE)('<p>Example of a human readable API status</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>~# curl -s -u admin:foobaz http://localhost:3000/api/v1/status |jq\n{\n  &quot;data&quot;: {\n    &quot;connect_url&quot;: &quot;http://0.0.0.0:8080&quot;,\n    &quot;fingerprint&quot;: &quot;2a:c8:79:09:80:ba:7c:60:05:e5:2c:99:6d:75:56:24&quot;,\n    &quot;clients_connected&quot;: 3,\n    &quot;clients_disconnected&quot;: 1,\n    &quot;version&quot;: &quot;0.1.28&quot;\n  }\n}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="connect-a-client-without-a-tunnel"><a class="header-anchor" href="#connect-a-client-without-a-tunnel">#</a> Connect a client without a tunnel</h2><p>Invoke the rport client without specifying a tunnel but with some extra data.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rport --id my-client-1 \\\n  --fingerprint &lt;YOUR_FINGERPRINT&gt; \\\n  --tag Linux --tag &quot;Office Berlin&quot; \\\n  --name &quot;My Test VM&quot; --auth user1:1234 \\\n  node1.example.com:8080\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><em>Add auth and fingerprint as already explained.</em></p><p>This attaches the client to the message queue of the server without creating a tunnel.</p><h2 id="manage-clients-and-tunnels-through-the-api"><a class="header-anchor" href="#manage-clients-and-tunnels-through-the-api">#</a> Manage clients and tunnels through the API</h2><p>On the server, you can supervise the attached clients using <code>curl -s -u admin:foobaz http://localhost:3000/api/v1/clients</code>. Here is an example:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>curl -s -u admin:foobaz http://localhost:3000/api/v1/clients|jq\n[\n  {\n    &quot;id&quot;: &quot;my-client-1&quot;,\n    &quot;name&quot;: &quot;My Test VM&quot;,\n    &quot;os&quot;: &quot;Linux my-devvm-v3 5.4.0-37-generic #41-Ubuntu SMP Wed Jun 3 18:57:02 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux&quot;,\n    &quot;os_arch&quot;: &quot;amd64&quot;,\n    &quot;os_family&quot;: &quot;debian&quot;,\n    &quot;os_kernel&quot;: &quot;linux&quot;,\n    &quot;hostname&quot;: &quot;my-devvm-v3&quot;,\n    &quot;ipv4&quot;: [\n      &quot;192.168.3.148&quot;\n    ],\n    &quot;ipv6&quot;: [\n      &quot;fe80::20c:29ff:fec8:b1f&quot;\n    ],\n    &quot;tags&quot;: [\n      &quot;Linux&quot;,\n      &quot;Office Berlin&quot;\n    ],\n    &quot;version&quot;: &quot;0.1.6&quot;,\n    &quot;address&quot;: &quot;87.123.136.***:63552&quot;,\n    &quot;tunnels&quot;: []\n  },\n   {\n    &quot;id&quot;: &quot;aa1210c7-1899-491e-8e71-564cacaf1df8&quot;,\n    &quot;name&quot;: &quot;Random Rport Client&quot;,\n    &quot;os&quot;: &quot;Linux alpine-3-10-tk-01 4.19.80-0-virt #1-Alpine SMP Fri Oct 18 11:51:24 UTC 2019 x86_64 Linux&quot;,\n    &quot;os_arch&quot;: &quot;amd64&quot;,\n    &quot;os_family&quot;: &quot;alpine&quot;,\n    &quot;os_kernel&quot;: &quot;linux&quot;,\n    &quot;hostname&quot;: &quot;alpine-3-10-tk-01&quot;,\n    &quot;ipv4&quot;: [\n      &quot;192.168.122.117&quot;\n    ],\n    &quot;ipv6&quot;: [\n      &quot;fe80::b84f:aff:fe59:a0ba&quot;\n    ],\n    &quot;tags&quot;: [\n      &quot;Linux&quot;,\n      &quot;Datacenter 1&quot;\n    ],\n    &quot;version&quot;: &quot;0.1.6&quot;,\n    &quot;address&quot;: &quot;88.198.189.***:43206&quot;,\n    &quot;tunnels&quot;: [\n      {\n        &quot;lhost&quot;: &quot;0.0.0.0&quot;,\n        &quot;lport&quot;: &quot;2222&quot;,\n        &quot;rhost&quot;: &quot;0.0.0.0&quot;,\n        &quot;rport&quot;: &quot;22&quot;,\n        &quot;id&quot;: &quot;1&quot;\n      }\n    ]\n  }\n]\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div>',10),W=(0,s.Uk)("There is one client connected with an active tunnel. The second client is in standby mode. Read more about the "),A=(0,s.Uk)("management of tunnel via the API"),_=(0,s.Uk)(" or read the "),T={href:"https://petstore.swagger.io/?url=https://raw.githubusercontent.com/cloudradar-monitoring/rport/master/api-doc.yml",target:"_blank",rel:"noopener noreferrer"},R=(0,s.Uk)("Swagger API docs"),j=(0,s.Uk)("."),L={render:function(n,e){const t=(0,s.up)("RouterLink"),L=(0,s.up)("OutboundLink");return(0,s.wg)(),(0,s.j4)(s.HY,null,[a,(0,s.Wm)("p",null,[o,(0,s.Wm)(t,{to:"/docs/no02-api-auth.html"},{default:(0,s.w5)((()=>[u])),_:1}),l]),r,(0,s.Wm)("div",i,[p,(0,s.Wm)("p",null,[c,(0,s.Wm)(t,{to:"/docs/no08-https-howto.html"},{default:(0,s.w5)((()=>[b])),_:1}),m])]),d,(0,s.Wm)("div",h,[q,(0,s.Wm)("p",null,[g,(0,s.Wm)("a",f,[v,(0,s.Wm)(L)]),k,x,w,(0,s.Wm)("a",y,[I,(0,s.Wm)(L)]),P])]),U,(0,s.Wm)("p",null,[W,(0,s.Wm)(t,{to:"/docs/no09-managing-tunnels.html"},{default:(0,s.w5)((()=>[A])),_:1}),_,(0,s.Wm)("a",T,[R,(0,s.Wm)(L)]),j])],64)}}}}]);